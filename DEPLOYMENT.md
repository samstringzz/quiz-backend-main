# Deployment Guide: Quiz Backend on Render with Supabase

## Prerequisites
- GitHub repository with your quiz backend code
- Supabase account
- Render account

## Step 1: Set up Supabase Database

### 1.1 Create a new Supabase project
1. Go to [supabase.com](https://supabase.com) and sign up/login
2. Click "New Project"
3. Choose your organization and enter project details
4. Wait for the project to be created

### 1.2 Get your database connection string
1. In your Supabase dashboard, go to Settings → Database
2. Copy the connection string (it looks like: `postgresql://postgres:[YOUR-PASSWORD]@db.[YOUR-PROJECT-REF].supabase.co:5432/postgres`)
3. Note down your database password

### 1.3 Set up the database schema
1. Go to SQL Editor in your Supabase dashboard
2. Copy the contents of `src/db/schema.sql` and run it
3. Copy the contents of `src/db/seed.sql` and run it

## Step 2: Deploy to Render

### 2.1 Connect your GitHub repository
1. Go to [render.com](https://render.com) and sign up/login
2. Click "New +" and select "Web Service"
3. Connect your GitHub account and select your quiz backend repository

### 2.2 Configure the service
- **Name**: `quiz-backend` (or your preferred name)
- **Environment**: `Node`
- **Build Command**: `npm install && npm run build`
- **Start Command**: `npm start`
- **Plan**: Choose the free plan to start

### 2.3 Set environment variables
Click on "Environment" and add these variables:

```
DATABASE_URL=postgresql://postgres:[YOUR-PASSWORD]@db.[YOUR-PROJECT-REF].supabase.co:5432/postgres
CORS_ORIGIN=https://your-frontend-domain.com
NODE_ENV=production
```

**Note**: `JWT_SECRET` will be automatically generated by Render.

### 2.4 Deploy
Click "Create Web Service" and wait for the deployment to complete.

## Step 3: Test your deployment

### 3.1 Health check
Your service will be available at: `https://your-service-name.onrender.com`

Test the health endpoint: `https://your-service-name.onrender.com/test`

### 3.2 Test database connection
Test the database endpoint: `https://your-service-name.onrender.com/test-db`

## Step 4: Update your frontend

Update your frontend's API base URL to point to your Render service:
```javascript
const API_BASE_URL = 'https://your-service-name.onrender.com';
```

## Troubleshooting

### Common issues:

1. **Build fails**: Check that all dependencies are in `package.json`
2. **Database connection fails**: Verify your `DATABASE_URL` is correct
3. **CORS errors**: Make sure `CORS_ORIGIN` matches your frontend domain exactly
4. **JWT errors**: The `JWT_SECRET` should be automatically generated by Render

### Logs:
- Check Render dashboard → Your service → Logs for any errors
- Check Supabase dashboard → Logs for database issues

## Security Notes

- Never commit your `.env` file to Git
- Use environment variables for all sensitive data
- Supabase automatically handles SSL connections
- JWT secrets are automatically generated by Render

## Cost Optimization

- Free tier on Render: 750 hours/month
- Free tier on Supabase: 500MB database, 2GB bandwidth
- Monitor usage in both dashboards
